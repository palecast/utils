<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Timezone Comparator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            font-size: 12px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .search-container {
            position: relative;
            width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .search-result-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
        }

        .search-result-item:hover {
            background: #f0f0f0;
        }

        .link-button {
            color: #0066ff;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
        }

        .link-button:hover {
            text-decoration: underline;
        }

        .scrollable-container {
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .timezone-table {
            display: inline-block;
            min-width: 100%;
        }

        .timezone-row {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
        }

        .timezone-row:last-child {
            border-bottom: none;
        }

        .city-info {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            width: 240px;
            background: white;
            position: sticky;
            left: 0;
            z-index: 10;
            border-right: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .offset-col {
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
        }

        .offset-col.home {
            cursor: default;
        }

        .home-icon {
            font-size: 18px;
        }

        .city-details {
            flex: 1;
            margin: 0 12px;
        }

        .city-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .timezone-label {
            display: inline-block;
            background: #e8e8e8;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-right: 4px;
            font-weight: 500;
        }

        .country-name {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        .remove-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #999;
            font-size: 16px;
            border-radius: 50%;
        }

        .remove-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .time-cells {
            display: flex;
            flex: 1;
            border-top: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
        }

        .time-cell {
            min-width: 42px;
            padding: 10px 6px;
            text-align: center;
            font-size: 11px;
            position: relative;
            cursor: pointer;
        }

        .time-cell.night {
            background: #d0d0d0;
        }

        .time-cell.day {
            background: #e6f2ff;
        }

        .time-cell.working {
            background: #fffbcc;
        }

        .time-cell.first-of-day {
            border-radius: 8px 0 0 8px;
        }

        .time-cell.last-of-day {
            border-radius: 0 8px 8px 0;
        }

        .time-cell.highlighted {
            background: #d4f4dd !important;
            border-left: 2px solid #555;
            border-right: 2px solid #555;
        }

        .time-cell.highlighted.first-highlight {
            border-left: 2px solid #555;
        }

        .time-cell.highlighted.last-highlight {
            border-right: 2px solid #555;
        }

        .hour-text {
            font-weight: 600;
            font-size: 12px;
        }

        .period-text {
            font-size: 9px;
            color: #666;
            margin-top: 2px;
        }

        .day-label {
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            font-weight: 600;
            color: #666;
        }

        .date-label {
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            font-weight: 600;
            color: white;
            background: #666;
            padding: 1px 4px;
            border-radius: 3px;
        }

        .scrollable-container {
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="+ Place or timezone" id="searchInput">
            <div class="search-results" id="searchResults" style="display: none;"></div>
        </div>
        <a class="link-button" id="shareLink">LINK TO THIS VIEW</a>
    </div>

    <div class="scrollable-container">
        <div class="timezone-table" id="timezoneTable"></div>
    </div>

    <script>
        const cities = [
            { name: 'London', country: 'United Kingdom, England', timezone: 'Europe/London' },
            { name: 'New York', country: 'United States, New York', timezone: 'America/New_York' },
            { name: 'Berlin', country: 'Germany', timezone: 'Europe/Berlin' },
            { name: 'Johannesburg', country: 'South Africa', timezone: 'Africa/Johannesburg' },
            { name: 'Tokyo', country: 'Japan', timezone: 'Asia/Tokyo' },
            { name: 'Paris', country: 'France', timezone: 'Europe/Paris' },
            { name: 'Sydney', country: 'Australia', timezone: 'Australia/Sydney' },
            { name: 'Los Angeles', country: 'United States, California', timezone: 'America/Los_Angeles' },
            { name: 'Singapore', country: 'Singapore', timezone: 'Asia/Singapore' },
            { name: 'Hong Kong', country: 'Hong Kong', timezone: 'Asia/Hong_Kong' },
            { name: 'Dubai', country: 'United Arab Emirates', timezone: 'Asia/Dubai' },
            { name: 'Mumbai', country: 'India', timezone: 'Asia/Kolkata' },
            { name: 'Moscow', country: 'Russia', timezone: 'Europe/Moscow' },
            { name: 'Istanbul', country: 'Turkey', timezone: 'Europe/Istanbul' },
            { name: 'Toronto', country: 'Canada, Ontario', timezone: 'America/Toronto' },
            { name: 'Chicago', country: 'United States, Illinois', timezone: 'America/Chicago' },
            { name: 'Houston', country: 'United States, Texas', timezone: 'America/Chicago' },
            { name: 'San Francisco', country: 'United States, California', timezone: 'America/Los_Angeles' },
            { name: 'Seattle', country: 'United States, Washington', timezone: 'America/Los_Angeles' },
            { name: 'Boston', country: 'United States, Massachusetts', timezone: 'America/New_York' },
            { name: 'Washington DC', country: 'United States', timezone: 'America/New_York' },
            { name: 'Mexico City', country: 'Mexico', timezone: 'America/Mexico_City' },
            { name: 'SÃ£o Paulo', country: 'Brazil', timezone: 'America/Sao_Paulo' },
            { name: 'Buenos Aires', country: 'Argentina', timezone: 'America/Argentina/Buenos_Aires' },
            { name: 'Madrid', country: 'Spain', timezone: 'Europe/Madrid' },
            { name: 'Rome', country: 'Italy', timezone: 'Europe/Rome' },
            { name: 'Amsterdam', country: 'Netherlands', timezone: 'Europe/Amsterdam' },
            { name: 'Brussels', country: 'Belgium', timezone: 'Europe/Brussels' },
            { name: 'Zurich', country: 'Switzerland', timezone: 'Europe/Zurich' },
            { name: 'Vienna', country: 'Austria', timezone: 'Europe/Vienna' },
            { name: 'Copenhagen', country: 'Denmark', timezone: 'Europe/Copenhagen' },
            { name: 'Stockholm', country: 'Sweden', timezone: 'Europe/Stockholm' },
            { name: 'Oslo', country: 'Norway', timezone: 'Europe/Oslo' },
            { name: 'Helsinki', country: 'Finland', timezone: 'Europe/Helsinki' },
            { name: 'Warsaw', country: 'Poland', timezone: 'Europe/Warsaw' },
            { name: 'Prague', country: 'Czech Republic', timezone: 'Europe/Prague' },
            { name: 'Budapest', country: 'Hungary', timezone: 'Europe/Budapest' },
            { name: 'Athens', country: 'Greece', timezone: 'Europe/Athens' },
            { name: 'Cairo', country: 'Egypt', timezone: 'Africa/Cairo' },
            { name: 'Lagos', country: 'Nigeria', timezone: 'Africa/Lagos' },
            { name: 'Nairobi', country: 'Kenya', timezone: 'Africa/Nairobi' },
            { name: 'Bangkok', country: 'Thailand', timezone: 'Asia/Bangkok' },
            { name: 'Jakarta', country: 'Indonesia', timezone: 'Asia/Jakarta' },
            { name: 'Manila', country: 'Philippines', timezone: 'Asia/Manila' },
            { name: 'Seoul', country: 'South Korea', timezone: 'Asia/Seoul' },
            { name: 'Beijing', country: 'China', timezone: 'Asia/Shanghai' },
            { name: 'Shanghai', country: 'China', timezone: 'Asia/Shanghai' },
            { name: 'Melbourne', country: 'Australia', timezone: 'Australia/Melbourne' },
            { name: 'Auckland', country: 'New Zealand', timezone: 'Pacific/Auckland' },
            { name: 'Vancouver', country: 'Canada, British Columbia', timezone: 'America/Vancouver' },
            { name: 'Montreal', country: 'Canada, Quebec', timezone: 'America/Montreal' },
            { name: 'Denver', country: 'United States, Colorado', timezone: 'America/Denver' },
            { name: 'Phoenix', country: 'United States, Arizona', timezone: 'America/Phoenix' },
            { name: 'Atlanta', country: 'United States, Georgia', timezone: 'America/New_York' },
            { name: 'Miami', country: 'United States, Florida', timezone: 'America/New_York' },
            { name: 'Stuttgart', country: 'Germany', timezone: 'Europe/Berlin' },
            { name: 'Lisbon', country: 'Portugal', timezone: 'Europe/Lisbon' },
            { name: 'Dublin', country: 'Ireland', timezone: 'Europe/Dublin' },
            { name: 'Edinburgh', country: 'United Kingdom, Scotland', timezone: 'Europe/London' },
            { name: 'Tel Aviv', country: 'Israel', timezone: 'Asia/Jerusalem' },
            { name: 'Riyadh', country: 'Saudi Arabia', timezone: 'Asia/Riyadh' }
        ];

        let selectedCities = [];
        let homeIndex = 0;
        let currentHoverColumn = -1;

        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const timezoneTable = document.getElementById('timezoneTable');
        const shareLink = document.getElementById('shareLink');

        function getTimezoneOffset(timezone) {
            const now = new Date();
            const tzDate = new Date(now.toLocaleString('en-US', { timeZone: timezone }));
            const localDate = new Date(now.toLocaleString('en-US', { timeZone: 'UTC' }));
            return (tzDate - localDate) / (1000 * 60 * 60);
        }

        function getTimezoneAbbr(timezone) {
            try {
                const abbr = new Intl.DateTimeFormat('en-US', {
                    timeZone: timezone,
                    timeZoneName: 'short'
                }).formatToParts(new Date()).find(part => part.type === 'timeZoneName')?.value;
                return abbr || '';
            } catch (e) {
                return '';
            }
        }

        function initFromURL() {
            const params = new URLSearchParams(window.location.search);
            const citiesParam = params.get('cities');
            const homeParam = params.get('home');

            if (citiesParam) {
                const cityNames = citiesParam.split(',');
                selectedCities = cityNames.map(name => {
                    return cities.find(c => c.name === decodeURIComponent(name));
                }).filter(c => c);
                
                if (homeParam !== null) {
                    homeIndex = parseInt(homeParam) || 0;
                }
            } else {
                selectedCities = [
                    cities.find(c => c.name === 'London'),
                    cities.find(c => c.name === 'New York'),
                    cities.find(c => c.name === 'Berlin'),
                    cities.find(c => c.name === 'Johannesburg')
                ];
                homeIndex = 0;
            }

            render();
        }

        function generateShareLink() {
            const cityNames = selectedCities.map(c => encodeURIComponent(c.name)).join(',');
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = `${baseUrl}?cities=${cityNames}&home=${homeIndex}`;
            
            navigator.clipboard.writeText(shareUrl).then(() => {
                const originalText = shareLink.textContent;
                shareLink.textContent = 'LINK COPIED!';
                setTimeout(() => {
                    shareLink.textContent = originalText;
                }, 2000);
            });
        }

        shareLink.addEventListener('click', generateShareLink);

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();
            
            if (query.length === 0) {
                searchResults.style.display = 'none';
                return;
            }

            const filtered = cities.filter(city => 
                city.name.toLowerCase().includes(query) ||
                city.country.toLowerCase().includes(query) ||
                city.timezone.toLowerCase().includes(query)
            ).filter(city => !selectedCities.some(sc => sc.name === city.name));

            if (filtered.length > 0) {
                searchResults.innerHTML = filtered.slice(0, 10).map(city => 
                    `<div class="search-result-item" data-city="${city.name}">
                        <div style="font-weight: 600;">${city.name}</div>
                        <div style="color: #666; font-size: 11px;">${city.country}</div>
                    </div>`
                ).join('');
                searchResults.style.display = 'block';
            } else {
                searchResults.style.display = 'none';
            }
        });

        searchResults.addEventListener('click', (e) => {
            const item = e.target.closest('.search-result-item');
            if (item) {
                const cityName = item.dataset.city;
                const city = cities.find(c => c.name === cityName);
                if (city) {
                    selectedCities.push(city);
                    render();
                    searchInput.value = '';
                    searchResults.style.display = 'none';
                }
            }
        });

        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.style.display = 'none';
            }
        });

        function removeCity(index) {
            selectedCities.splice(index, 1);
            if (homeIndex >= selectedCities.length) {
                homeIndex = Math.max(0, selectedCities.length - 1);
            } else if (index < homeIndex) {
                homeIndex--;
            }
            render();
        }

        function setHome(index) {
            homeIndex = index;
            render();
        }

        function getTimeClass(hour) {
            if (hour >= 22 || hour < 6) return 'night';
            if (hour >= 8 && hour < 17) return 'working';
            return 'day';
        }

        function render() {
            if (selectedCities.length === 0) {
                timezoneTable.innerHTML = '<div style="padding: 40px; text-align: center; color: #999;">Add cities to compare timezones</div>';
                return;
            }

            const homeCity = selectedCities[homeIndex];
            const homeOffset = getTimezoneOffset(homeCity.timezone);

            const now = new Date();
            const homeTime = new Date(now.toLocaleString('en-US', { timeZone: homeCity.timezone }));
            const startHour = 0;
            
            const hours = [];
            for (let i = 0; i < 24; i++) {
                const date = new Date(homeTime);
                date.setHours(startHour + i, 0, 0, 0);
                hours.push(date);
            }

            const rows = selectedCities.map((city, cityIndex) => {
                const offset = getTimezoneOffset(city.timezone);
                const offsetDiff = offset - homeOffset;
                const isHome = cityIndex === homeIndex;
                const tzAbbr = getTimezoneAbbr(city.timezone);

                const timeCells = hours.map((homeHour, hourIndex) => {
                    const cityDate = new Date(homeHour.toLocaleString('en-US', { timeZone: city.timezone }));
                    const hour = cityDate.getHours();
                    const hour12 = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                    const period = hour >= 12 ? 'pm' : 'am';
                    
                    const isFirstOfDay = hour === 0;
                    const isLastOfDay = hour === 23;
                    const timeClass = getTimeClass(hour);

                    const dayLabel = isFirstOfDay ? cityDate.toLocaleDateString('en-US', { weekday: 'short' }).toUpperCase() : '';

                    if (isFirstOfDay) {
                        return `
                            <div class="time-cell ${timeClass} first-of-day" 
                                 data-column="${hourIndex}" data-row="${cityIndex}">
                                <div class="hour-text">${dayLabel}</div>
                            </div>
                        `;
                    }

                    return `
                        <div class="time-cell ${timeClass} ${isLastOfDay ? 'last-of-day' : ''}" 
                             data-column="${hourIndex}" data-row="${cityIndex}">
                            <div class="hour-text">${hour12}</div>
                            <div class="period-text">${period}</div>
                        </div>
                    `;
                }).join('');

                const offsetDisplay = isHome 
                    ? '<span class="home-icon">ð </span>' 
                    : `${offsetDiff >= 0 ? '+' : ''}${Math.round(offsetDiff)}`;

                return `
                    <div class="timezone-row">
                        <div class="city-info">
                            <div class="offset-col ${isHome ? 'home' : ''}" onclick="${isHome ? '' : `setHome(${cityIndex})`}">
                                ${offsetDisplay}
                            </div>
                            <div class="city-details">
                                <div class="city-name">${city.name} <span class="timezone-label">${tzAbbr}</span></div>
                                <div class="country-name">${city.country}</div>
                            </div>
                            <div class="remove-btn" onclick="removeCity(${cityIndex})">Ã</div>
                        </div>
                        <div class="time-cells">
                            ${timeCells}
                        </div>
                    </div>
                `;
            }).join('');

            timezoneTable.innerHTML = rows;

            document.querySelectorAll('.time-cell').forEach(cell => {
                cell.addEventListener('mouseenter', handleCellHover);
                cell.addEventListener('mouseleave', handleCellLeave);
            });
        }

        function handleCellHover(e) {
            const column = parseInt(e.target.closest('.time-cell').dataset.column);
            currentHoverColumn = column;
            
            document.querySelectorAll('.time-cell').forEach(cell => {
                const cellColumn = parseInt(cell.dataset.column);
                if (cellColumn === column) {
                    cell.classList.add('highlighted');
                }
            });
        }

        function handleCellLeave() {
            document.querySelectorAll('.time-cell').forEach(cell => {
                cell.classList.remove('highlighted');
            });
            currentHoverColumn = -1;
        }

        initFromURL();
    </script>
</body>
</html>